---
# This is exact copy of main playbook, except oefenweb.swapfile is skipped
# because it's not possible to test it on Travis CI. Also we manually add
# vagrant user as it does not exist in Docker.
- hosts: all
  remote_user: root

  pre_tasks:
    - name: Add vagrant user
      user:
        name: vagrant
        # This password hash has been generated by running the following command
        # with password 'vagrant':
        #
        # mkpasswd --method=sha-512
        password: $6$4kot6S9fS2oGx$gUxPU4xvSSoMku2OHTwPtCDLNCU4OszJMv6616/1DmaLel15k5hNha451ce4tP6hIMd2H.suCv8cb/NNASdPd0
        uid: 1000

  roles:
    - ../provisioning/roles/draft
    - ../provisioning/roles/git_config
    - ../provisioning/roles/apache2
    - ../provisioning/roles/mysql
    - geerlingguy.mailhog
    - T2L.php
    - T2L.composer
    - T2L.java
    - { role: T2L.solr, solr_cleanup_downloads: false, solr_cleanup_gpg: false }
  vars_files:
    - ../provisioning/vars/swapfile.yml
    - ../provisioning/vars/php.yml
    - ../provisioning/vars/solr.yml
    - ../provisioning/vars/mailhog.yml
    - test-vm-settings.yml
